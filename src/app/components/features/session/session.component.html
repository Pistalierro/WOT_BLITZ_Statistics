<div class="container">
  <div class="session-container">
    <!-- –ó–∞–≥–æ–ª–æ–≤–æ–∫ + —Å—Ç–∞—Ç—É—Å –Ω–∞ –æ–¥–Ω–æ–π —Å—Ç—Ä–æ–∫–µ -->
    <!-- –ó–∞–≥–æ–ª–æ–≤–æ–∫ -->
    <div class="session-header">
      <div class="session-title">
        <span class="material-symbols-outlined">stadia_controller</span>
        <h2>–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∏–≥—Ä–æ–≤–æ–π —Å–µ—Å—Å–∏–µ–π</h2>
      </div>

      <!-- –°—Ç–∞—Ç—É—Å —Ç–µ–ø–µ—Ä—å –ø–æ–¥ –∑–∞–≥–æ–ª–æ–≤–∫–æ–º -->
      <div class="session-status">
        <span *ngIf="sessionActive()" @fadeScale class="session-badge session-badge--active">üü¢ –°–µ—Å—Å–∏—è –∞–∫—Ç–∏–≤–Ω–∞</span>
        <span *ngIf="!sessionActive()" @fadeScale class="session-badge session-badge--inactive">üî¥ –°–µ—Å—Å–∏—è –Ω–µ–∞–∫—Ç–∏–≤–Ω–∞</span>
      </div>
    </div>

    <div class="session-progress-bar">
      <mat-progress-bar *ngIf="sessionState.loadingSignal()" color="warn" mode="indeterminate"></mat-progress-bar>
    </div>

    <!-- –û—à–∏–±–∫–∏ -->
    <div *ngIf="sessionError() as error" class="error-message">
      <p>{{ error }}</p>
    </div>

    <!-- –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–µ—Å—Å–∏–µ–π -->
    <div class="session-controls">
      <button (click)="startSession()" *ngIf="!sessionActive()" mat-flat-button>
        <div class="actions-container">
          <span>–ù–∞—á–∞—Ç—å —Å–µ—Å—Å–∏—é</span>
          <span class="material-symbols-outlined">line_start_arrow_notch</span>
        </div>
      </button>
      <ng-container *ngIf="sessionActive()">
        <button (click)="updateSession()" mat-flat-button>
          <div class="actions-container">
            <span>–û–±–Ω–æ–≤–∏—Ç—å —Å–µ—Å—Å–∏—é</span>
            <span class="material-symbols-outlined">refresh</span>
          </div>
        </button>
        <button (click)="endSession()" mat-flat-button>
          <div class="actions-container">
            <span>–ó–∞–≤–µ—Ä—à–∏—Ç—å —Å–µ—Å—Å–∏—é</span>
            <span class="material-symbols-outlined">cancel</span>
          </div>
        </button>
      </ng-container>
    </div>

    <!-- –î–∞–Ω–Ω—ã–µ —Å–µ—Å—Å–∏–∏ -->
    <div class="session-data">
      <div *ngIf="sessionState.startStats() as startStats">
        <h3>–°—Ç–∞—Ä—Ç–æ–≤–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞:</h3>
        <p>–°—ã–≥—Ä–∞–Ω–æ –±–æ—ë–≤: {{ startStats.battles }}</p>
        <p>–ü–æ–±–µ–¥: {{ startStats.wins }}</p>
      </div>

      <div *ngIf="sessionState.intermediateStats() as intermediateStats">
        <h3>{{ sessionState.sessionActive() ? '–ü—Ä–æ–º–µ–∂—É—Ç–æ—á–Ω—ã–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã:' : '–ò—Ç–æ–≥–æ–≤—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:' }} </h3>
        <p>–°—ã–≥—Ä–∞–Ω–æ –±–æ—ë–≤: {{ intermediateStats.battles }}</p>
        <p>–ü–æ–±–µ–¥: {{ intermediateStats.wins }}</p>
        <p>–í–∏–Ω—Ä–µ–π—Ç: {{ intermediateStats.winRate | number: '1.0-2' }}%</p>
        <p>–°—Ä–µ–¥–Ω–∏–π —É—Ä–æ–Ω: {{ intermediateStats.avgDamage | number: '1.0-0' }}</p>
      </div>
    </div>

    <div *ngIf="intermediateTanksDelta.length > 0">
      <h3>–ü—Ä–æ–º–µ–∂—É—Ç–æ—á–Ω–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ —Ç–∞–Ω–∫–∞–º:</h3>
      <div [@slideUp] class="card-grid">
        <mat-card
          (click)="toggleFlip(i)"
          *ngFor="let tank of tanksDelta; let i = index"
          [ngClass]="{'flipped': isFlipped[i]}"
          class="card">

          <div class="card-front">
            <mat-card-content class="card-image__container">
              <div [ngStyle]="{'background-image': 'url(' + getFlagUrl(tank.nation) + ')'}" class="card-background">
                <img [alt]="tank.name" [src]="tank.images?.preview" class="tank-image">
                <div class="tank-tier">{{ toRoman(tank.tier) }}</div>
                <img [alt]="tank.type" [src]="tankTypes(tank.type)" class="tank-type">
                <div class="tank-name">{{ tank.name }}</div>
                <div class="card-overlay"></div>
              </div>
            </mat-card-content>

            <mat-card-actions class="tank-stats">
              <div class="tank-stats__item">
                <span class="material-symbols-outlined tank-stat__icon">swords</span>
                <span>{{ tank.battles }}</span>
              </div>
              <div class="tank-stats__item">
                <mat-icon class="stat-icon">emoji_flags</mat-icon>
                <span>{{ tank.winRate | number: '1.0-0' }}%</span>
              </div>
              <div class="tank-stats__item">
                <span>–°/–£: {{ tank.avgDamage | number: '1.0-0' }}</span>
              </div>
            </mat-card-actions>
          </div>

          <!-- –ó–∞–¥–Ω—è—è —Å—Ç–æ—Ä–æ–Ω–∞ –∫–∞—Ä—Ç–æ—á–∫–∏ -->
          <div class="card-back">
            <h4 class="card-back__title">–û–±—â–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞</h4>
            <mat-card-content class="card-back__content">
              <div class="card-back__name">{{ tank.name }}</div>
              <div class="card-back__item">
                <span>–ù–∞—Ü–∏—è:</span>
                <img [alt]="tank.nation" [src]="getFlagUrl(tank.nation)">
              </div>
              <div class="card-back__item">
                <span>–¢–∏–ø:</span>
                <img [alt]="tank.name" [src]="tankTypes(tank.type)">
              </div>
              <div class="card-back__item">
                <span>–£—Ä–æ–≤–µ–Ω—å:</span>
                <span>{{ toRoman(tank.tier) }}</span>
              </div>
              <div class="card-back__item">
                <span>–í—Å–µ–≥–æ –±–æ—ë–≤:</span>
                <span>{{ tank.totalBattles }}</span>
              </div>
              <div class="card-back__item">
                <span>–í—Å–µ–≥–æ –ø–æ–±–µ–¥:</span>
                <span>{{ tank.totalWins }}</span>
              </div>
              <div class="card-back__item">
                <span>–û–±—â–∏–π –ø—Ä–æ—Ü–µ–Ω—Ç:</span>
                <span>{{ tank.totalWinRate | number: '1.0-2' }}%</span>
              </div>
              <div class="card-back__item">
                <span>–°/–£:</span>
                <span>{{ tank.totalAvgDamage | number: '1.0-0' }}</span>
              </div>
            </mat-card-content>
          </div>
        </mat-card>
      </div>
    </div>

  </div>
</div>
