<div class="container">
  <div class="session-container">
    <h2>Управление игровой сессией</h2>

    <!-- Индикатор состояния -->
    <div class="session-status">
      <ng-container *ngIf="sessionActive(); else noSession">
        <p class="active-session">Сессия активна</p>
      </ng-container>
      <ng-template #noSession>
        <p class="inactive-session">Сессия неактивна. Для старта сессии нажмите "Начать сессию"</p>
      </ng-template>
    </div>

    <!-- Ошибки -->
    <div *ngIf="sessionError() as error" class="error-message">
      <p>{{ error }}</p>
    </div>

    <!-- Управление сессией -->
    <div class="session-controls">
      <button (click)="startSession()" *ngIf="!sessionActive()" color="primary" mat-flat-button>
        Начать сессию
      </button>
      <ng-container *ngIf="sessionActive()">
        <button (click)="updateSession()" color="accent" mat-flat-button>
          Обновить сессию
        </button>
        <button (click)="endSession()" color="warn" mat-flat-button>
          Завершить сессию
        </button>
      </ng-container>
    </div>

    <!-- Данные сессии -->
    <div class="session-data">
      <div *ngIf="sessionState.startStats() as startStats">
        <h3>Стартовая статистика:</h3>
        <p>Сыграно боёв: {{ startStats.battles }}</p>
        <p>Побед: {{ startStats.wins }}</p>
      </div>

      <div *ngIf="sessionState.intermediateStats() as intermediateStats">
        <h3>Промежуточные результаты:</h3>
        <p>Сыграно боёв: {{ intermediateStats.battles }}</p>
        <p>Побед: {{ intermediateStats.wins }}</p>
        <p>Винрейт: {{ intermediateStats.winRate | number: '1.0-2' }}%</p>
        <p>Средний урон: {{ intermediateStats.avgDamage | number: '1.0-0' }}</p>
      </div>

      <div *ngIf="sessionState.sessionStats() as sessionStats">
        <h3>Итоговая статистика за сессию:</h3>
        <p>Сыграно боёв: {{ sessionStats.battles }}</p>
        <p>Побед: {{ sessionStats.wins }}</p>
        <p>Винрейт: {{ sessionStats.winRate | number: '1.0-2' }}%</p>
        <p>Средний урон: {{ sessionStats.avgDamage | number: '1.0-0' }}</p>
      </div>
    </div>

    <h3>Промежуточная статистика по танкам:</h3>
    <div *ngIf="intermediateTanksDelta.length > 0" class="card-grid">

      <mat-card *ngFor="let tank of tanksDelta" appearance="outlined" class="card">

        <mat-card-content class="card-image-container">
          <div [ngStyle]="{'background-image': 'url(' + getFlagUrl(tank.nation) + ')'}" class="card-background">
            <img [alt]="tank.name" [src]="tank.images?.preview" class="tank-image">
            <div class="tank-tier">{{ toRoman(tank.tier) }}</div>
            <img [alt]="tank.type" [src]="tankTypes(tank.type)" class="tank-type">
            <div class="tank-name">{{ tank.name }}</div>
            <div class="card-overlay"></div>
          </div>
        </mat-card-content>

        <mat-card-actions class="tank-stats">
          <div class="tank-stats-item">
            <span class="material-symbols-outlined stat-icon">swords</span>
            <span>{{ tank.battles }}</span>
          </div>
          <div class="tank-stats-item">
            <mat-icon class="stat-icon">emoji_flags</mat-icon>
            <span>{{ tank.winRate | number: '1.0-0' }}%</span>
          </div>
          <div class="tank-stats-item">
            <span>С/У: {{ tank.avgDamage | number: '1.0-0' }}</span>
          </div>
        </mat-card-actions>
      </mat-card>
    </div>

  </div>
</div>
