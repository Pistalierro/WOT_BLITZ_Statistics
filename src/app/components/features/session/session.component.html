<div class="container">
  <div class="session-container">
    <!-- –ó–∞–≥–æ–ª–æ–≤–æ–∫ –∏ —Å—Ç–∞—Ç—É—Å -->
    <div class="session-header">
      <div class="session-title">
        <span class="material-symbols-outlined">stadia_controller</span>
        <h2>–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∏–≥—Ä–æ–≤–æ–π —Å–µ—Å—Å–∏–µ–π</h2>
      </div>
      <div class="session-status">
        <span *ngIf="sessionActive()" @fadeScale class="session-badge session-badge--active">
          üü¢ –°–µ—Å—Å–∏—è –∞–∫—Ç–∏–≤–Ω–∞
        </span>
        <span *ngIf="!sessionActive()" @fadeScale class="session-badge session-badge--inactive">
          üî¥ –°–µ—Å—Å–∏—è –Ω–µ–∞–∫—Ç–∏–≤–Ω–∞
        </span>
      </div>
    </div>

    <!-- –ü—Ä–æ–≥—Ä–µ—Å—Å-–±–∞—Ä -->
    <div class="session-progress-bar">
      <mat-progress-bar
        *ngIf="sessionState.loadingSignal()"
        color="warn"
        mode="indeterminate">
      </mat-progress-bar>
    </div>

    <!-- –û—à–∏–±–∫–∏ -->
    <div *ngIf="sessionError() as error" class="error-message">
      <p>{{ error }}</p>
    </div>

    <!-- –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ -->
    <div class="session-controls">
      <button (click)="startSession()" *ngIf="!sessionActive()" mat-flat-button>
        <div class="actions-container">
          <span>–ù–∞—á–∞—Ç—å —Å–µ—Å—Å–∏—é</span>
          <span class="material-symbols-outlined">line_start_arrow_notch</span>
        </div>
      </button>

      <ng-container *ngIf="sessionActive()">
        <button (click)="updateSession()" mat-flat-button>
          <div class="actions-container">
            <span>–û–±–Ω–æ–≤–∏—Ç—å —Å–µ—Å—Å–∏—é</span>
            <span class="material-symbols-outlined">refresh</span>
          </div>
        </button>
        <button (click)="endSession()" mat-flat-button>
          <div class="actions-container">
            <span>–ó–∞–≤–µ—Ä—à–∏—Ç—å —Å–µ—Å—Å–∏—é</span>
            <span class="material-symbols-outlined">cancel</span>
          </div>
        </button>
      </ng-container>
    </div>

    <!-- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ -->
    <div class="session-data">
      <!-- –°—Ç–∞—Ä—Ç–æ–≤–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ -->
      <div *ngIf="sessionState.startStats() as startStats">
        <h3>–°—Ç–∞—Ä—Ç–æ–≤–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞:</h3>
        <p>–°—ã–≥—Ä–∞–Ω–æ –±–æ—ë–≤: {{ startStats.battles | number: '1.0-0' }}</p>
        <p>–ü–æ–±–µ–¥: {{ startStats.wins | number: '1.0-0' }}</p>
        <p>–í–∏–Ω—Ä–µ–π—Ç: {{ (startStats.wins / startStats.battles) * 100 | number: '1.0-2' }}%</p>
        <p>–°—Ä–µ–¥–Ω–∏–π —É—Ä–æ–Ω: {{ startStats.damage_dealt / startStats.battles | number: '1.0-0' }}</p>
      </div>

      <!-- –ü—Ä–æ–º–µ–∂—É—Ç–æ—á–Ω—ã–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã -->
      <div *ngIf="sessionState.intermediateStats() as intermediateStats">
        <h3>{{ sessionState.sessionActive() ? '–ü—Ä–æ–º–µ–∂—É—Ç–æ—á–Ω—ã–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã:' : '–ò—Ç–æ–≥–æ–≤—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:' }}</h3>
        <p>–°—ã–≥—Ä–∞–Ω–æ –±–æ—ë–≤: <span [appOdometer]="intermediateStats.battles">{{ intermediateStats.battles }}</span></p>
        <p>–ü–æ–±–µ–¥: <span [appOdometer]="intermediateStats.wins">{{ intermediateStats.wins }}</span></p>
        <p>–í–∏–Ω—Ä–µ–π—Ç: <span [appOdometer]="intermediateStats.winRate" [format]="'1.2-2'">{{ intermediateStats.winRate }}</span>%</p>
        <p>–°—Ä–µ–¥–Ω–∏–π —É—Ä–æ–Ω: <span [appOdometer]="intermediateStats.avgDamage">{{ intermediateStats.avgDamage | number: '1.0-0' }}</span></p>
      </div>
    </div>

    <!-- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ —Ç–∞–Ω–∫–∞–º -->
    <div *ngIf="intermediateTanksDelta.length > 0">
      <h3>{{ sessionState.sessionActive() ? '–ü—Ä–æ–º–µ–∂—É—Ç–æ—á–Ω–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ —Ç–∞–Ω–∫–∞–º:' : '–ò—Ç–æ–≥–æ–≤–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ —Ç–∞–Ω–∫–∞–º:' }}</h3>
      <div [@slideUp] class="card-grid">
        <mat-card (click)="toggleFlip(i)" *ngFor="let tank of tanksDelta; let i = index" [ngClass]="{'flipped': isFlipped[i]}" class="card">

          <!-- –ü–µ—Ä–µ–¥–Ω—è—è —Å—Ç–æ—Ä–æ–Ω–∞ –∫–∞—Ä—Ç–æ—á–∫–∏ -->
          <div class="card-front">
            <mat-card-content class="card-image__container">
              <div [ngStyle]="{'background-image': 'url(' + getFlagUrl(tank.nation) + ')'}" class="card-background">
                <img [alt]="tank.name" [src]="sanitizeUrl(tank.images?.preview)" class="tank-image">
                <div class="tank-tier">{{ toRoman(tank.tier) }}</div>
                <img [alt]="tank.type" [src]="tankTypes(tank.type)" class="tank-type">
                <div class="tank-name">{{ tank.name }}</div>
                <div class="card-overlay"></div>
              </div>
            </mat-card-content>

            <!-- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ -->
            <mat-card-actions class="tank-stats">
              <div class="tank-stats__item">
                <span class="material-symbols-outlined tank-stat__icon">swords</span>
                <span [appOdometer]="tank.battles">{{ tank.battles }}</span>
              </div>
              <div class="tank-stats__item">
                <mat-icon class="stat-icon">emoji_flags</mat-icon>
                <span [appOdometer]="tank.winRate" [format]="'1.2-2'">{{ tank.winRate }}%</span>
              </div>
              <div class="tank-stats__item">
                <span>–°/–£</span>
                <span [appOdometer]="tank.avgDamage">{{ tank.avgDamage | number: '1.0-0' }}</span>
              </div>
            </mat-card-actions>
          </div>

          <!-- –ó–∞–¥–Ω—è—è —Å—Ç–æ—Ä–æ–Ω–∞ –∫–∞—Ä—Ç–æ—á–∫–∏ -->
          <div class="card-back">
            <h4 class="card-back__title">–û–±—â–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞</h4>
            <mat-card-content class="card-back__content">
              <div class="card-back__name">{{ tank.name }}</div>
              <div class="card-back__item">
                <span>–ù–∞—Ü–∏—è:</span>
                <img [alt]="tank.nation" [src]="getFlagUrl(tank.nation)">
              </div>
              <div class="card-back__item">
                <span>–¢–∏–ø:</span>
                <img [alt]="tank.type" [src]="tankTypes(tank.type)">
              </div>
              <div class="card-back__item">
                <span>–£—Ä–æ–≤–µ–Ω—å:</span>
                <span>{{ toRoman(tank.tier) }}</span>
              </div>
              <div class="card-back__item">
                <span>–í—Å–µ–≥–æ –±–æ—ë–≤:</span>
                <span>{{ tank.totalBattles }}</span>
              </div>
              <div class="card-back__item">
                <span>–í—Å–µ–≥–æ –ø–æ–±–µ–¥:</span>
                <span>{{ tank.totalWins }}</span>
              </div>
              <div class="card-back__item">
                <span>–û–±—â–∏–π –ø—Ä–æ—Ü–µ–Ω—Ç:</span>
                <span>{{ tank.totalWinRate | number: '1.0-2' }}%</span>
              </div>
              <div class="card-back__item">
                <span>–°/–£:</span>
                <span>{{ tank.totalAvgDamage | number: '1.0-0' }}</span>
              </div>
            </mat-card-content>
          </div>
        </mat-card>
      </div>
    </div>
  </div>
</div>
